<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--favicon-->
    <link rel="icon" th:href="@{/images/favicon-32x32.png}" type="image/png"/>
    <!--plugins-->
    <link th:href="@{/plugins/simplebar/css/simplebar.css}" rel="stylesheet"/>
    <link th:href="@{/plugins/perfect-scrollbar/css/perfect-scrollbar.css}" rel="stylesheet"/>
    <link th:href="@{/plugins/metismenu/css/metisMenu.min.css}" rel="stylesheet"/>
    <!-- loader-->
    <link th:href="@{/css/pace.min.css}" rel="stylesheet"/>
    <script th:src="@{/js/pace.min.js}"></script>
    <!-- Bootstrap CSS -->
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link th:href="@{/css/app.css}" rel="stylesheet">
    <link th:href="@{/css/icons.css}" rel="stylesheet">
    <title>注册页面</title>

    <style>
        h6 {
            font-family: 楷体, serif;
            color: red;
        }
    </style>
</head>

<body class="bg-login">
    `<!--wrapper-->
    <div class="wrapper">
        <div class="d-flex align-items-center justify-content-center my-5 my-lg-0">
            <div class="container">
                <div class="row row-cols-1 row-cols-lg-2 row-cols-xl-2">
                    <div class="col mx-auto">
                        <div class="my-4 text-center">
                            <img th:src="@{/images/logo-img.png}" width="180" alt=""/>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="border p-4 rounded">
                                    <div class="text-center">
                                        <h3 class="">注 册</h3>
                                        <p>已经有账号了？ <a th:href="@{/toLogin}">点此登录</a>
                                        </p>
                                    </div>

                                    <div class="form-body">
                                        <form class="row g-3" th:action="@{/user/register}" th:onsubmit="return check()">
                                            <div th:class="col-12">
                                                <div th:class="display_flex">
                                                    <div th:class="display_flex">
                                                        <label th:for="inputPhone" th:class="form-label">手机号码(登录账号)</label>
                                                        <h6><small>（必填项）</small></h6>
                                                    </div>
                                                    <div th:class="col-2"></div>
                                                    <div th:class="col-5">
                                                        <!--消息回显，如果msg消息不为空显示提示信息-->
                                                        <p style="color: red" th:id="message" th:text="${msg}" ></p>
                                                    </div>
                                                </div>
                                                <input type="text" name="phone" class="form-control" id="inputPhone" th:placeholder="请输入手机号码">
                                            </div>

                                            <div th:class="col-6">
                                                <div th:class="display_flex">
                                                    <label th:for="inputUsername" th:class="form-label ">用户名</label>
                                                    <h6><small>（必填项）</small></h6>
                                                </div>
                                                <input type="text" name="username" class="form-control" id="inputUsername" th:placeholder="zhangsan_12138">
                                            </div>

                                            <div th:class="col-6">
                                                <div th:class="display_flex">
                                                    <label th:for="inputPassword" th:class="form-label">密码</label>
                                                    <h6><small>（必填项）</small></h6>
                                                </div>
                                                <div class="input-group" th:id="show_hide_password">
                                                    <input type="password" class="form-control border-end-0" name="password" id="inputPassword" th:placeholder="请输入密码">
                                                    <a href="javascript:;" class="input-group-text bg-transparent"><i class='bx bx-hide'></i></a>
                                                </div>
                                            </div>
                                            <div th:class="col-6">
                                                <div th:class="display_flex">
                                                    <label th:for="reInputPassword" th:class="form-label">确认密码</label>
                                                    <h6><small>（必填项）</small></h6>
                                                </div>
                                                <div class="input-group" th:id="show_hide_password">
                                                    <input th:type="password" class="form-control border-end-0" name="rePassword" id="reInputPassword" th:placeholder="请确认密码">
                                                    <a href="javascript:;" class="input-group-text bg-transparent"><i class='bx bx-hide'></i></a>
                                                </div>
                                            </div>
                                            <div th:class="col-6">
                                                <label th:for="inputEmail" th:class="form-label">邮件</label>
                                                <input th:type="text" name="email" class="form-control" id="inputEmail" th:placeholder="请输入Email">
                                            </div>
                                            <div th:class="col-12">
                                                <label th:for="selectLocation" class="form-label">所在地</label>
                                                <div th:class="display_flex">
                                                    <div th:class="col-9">
                                                        <select class="form-select" name="location" id="selectLocation"
                                                                aria-label="Default select example">
                                                            <option selected value="">--请选择省份--</option>
                                                            <option value="北京市">北京市</option>
                                                            <option value="天津市">天津市</option>
                                                            <option value="河北省">河北省</option>
                                                            <option value="山西省">山西省</option>
                                                            <option value="内蒙古自治区">内蒙古自治区</option>
                                                            <option value="辽宁省">辽宁省</option>
                                                            <option value="吉林省">吉林省</option>
                                                            <option value="黑龙江省">黑龙江省</option>
                                                            <option value="上海市">上海市</option>
                                                            <option value="江苏省">江苏省</option>
                                                            <option value="浙江省">浙江省</option>
                                                            <option value="安徽省">安徽省</option>
                                                            <option value="福建省">福建省</option>
                                                            <option value="江西省">江西省</option>
                                                            <option value="山东省">山东省</option>
                                                            <option value="河南省">河南省</option>
                                                            <option value="湖北省">湖北省</option>
                                                            <option value="湖南省">湖南省</option>
                                                            <option value="广东省">广东省</option>
                                                            <option value="广西壮族自治区">广西壮族自治区</option>
                                                            <option value="海南省">海南省</option>
                                                            <option value="重庆市">重庆市</option>
                                                            <option value="四川省">四川省</option>
                                                            <option value="贵州省">贵州省</option>
                                                            <option value="云南省">云南省</option>
                                                            <option value="西藏自治区">西藏自治区</option>
                                                            <option value="陕西省">陕西省</option>
                                                            <option value="甘肃省">甘肃省</option>
                                                            <option value="青海省">青海省</option>
                                                            <option value="宁夏回族自治区">宁夏回族自治区</option>
                                                            <option value="新疆维吾尔自治区">新疆维吾尔自治区</option>
                                                            <option value="香港特别行政区">香港特别行政区</option>
                                                            <option value="澳门特别行政区">澳门特别行政区</option>
                                                            <option value="台湾省">台湾省</option>
                                                            <option value="其它">其它</option>
                                                        </select>
                                                    </div>
                                                    <div th:class="col-3">
                                                        <button class="btn btn-info px-4" onclick="getLocation()">自动定位</button>
                                                    </div>

                                                </div>

                                            </div>
                                            <div th:class="col-12">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked">
                                                    <label class="form-check-label" for="flexSwitchCheckChecked">我已认真阅读用户手册</label>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="d-grid">
                                                    <button th:type="submit" class="btn btn-primary"><i class='bx bx-user'></i>注 册
                                                    </button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--end row-->
            </div>
        </div>
    </div>
    <!--end wrapper-->
    <!-- Bootstrap JS -->
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <!--plugins-->
    <script th:src="@{/js/jquery.min.js}"></script>
    <script th:src="@{/plugins/simplebar/js/simplebar.min.js}"></script>
    <script th:src="@{/plugins/metismenu/js/metisMenu.min.js}"></script>
    <script th:src="@{/plugins/perfect-scrollbar/js/perfect-scrollbar.js}"></script>
    <!--app JS-->
    <script th:src="@{/js/app.js}"></script>`

    <!--Password show & hide js -->
    <script>
        $(document).ready(function () {
            $("#show_hide_password a").on('click', function (event) {
                event.preventDefault();
                if ($('#show_hide_password input').attr("type") == "text") {
                    $('#show_hide_password input').attr('type', 'password');
                    $('#show_hide_password i').addClass("bx-hide");
                    $('#show_hide_password i').removeClass("bx-show");
                } else if ($('#show_hide_password input').attr("type") == "password") {
                    $('#show_hide_password input').attr('type', 'text');
                    $('#show_hide_password i').removeClass("bx-hide");
                    $('#show_hide_password i').addClass("bx-show");
                }
            });
        });
    </script>

    <!--字段填写判断-->
    <script>
        function check() {
            var username = $("#inputUsername").val();
            var password = $("#inputPassword").val();
            var rePassword = $("#reInputPassword").val();
            var phone = $("#inputPhone").val();
            var email = $("#inputEmail").val();
            //判断用户名，密码是否为空
            if (username === "" || password === "" || rePassword === "" || phone === ""){
                $("#message").text("用户名、密码、账号不能为空");
                return false;
            }
            //正则表达式判断密码格式
            if (!(/^(?![0-9]+$)(?![a-z]+$)(?![A-Z]+$)(?!([^(0-9a-zA-Z)])+$).{6,20}$/.test(password))){
                $("#message").text("密码不合规范")
                return false;
            }
            //判断两次密码是否一致
            if (password !== rePassword){
                $("#message").text("两次输入密码不一致！");
                return false;
            }
            //判断手机号码是否合法
            if (phone !== "" && !(/^1(3|4|5|6|7|8|9)\d{9}$/.test(phone))){
                $("#message").text("手机号码不符合规范！");
                return false;
            }
            //判断邮箱是否合法
            if (email !== "" && !(/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(email))){
                $("#message").text("邮箱不符合规范！");
                alert("邮箱不符合规范")
                return false;
            }
            // 判断用户是否勾选“已阅读用户手册”
            if (!$("#flexSwitchCheckChecked").get(0).checked){
                alert("请勾选用户手册")
                return false;
            }
            return true;
        }
    </script>

    <!--百度地图定位功能-->
    <!--引用百度地图API文件， 您的秘钥的获取方式是注册为百度地图的开发者，创建应用-->
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=PlhFWpA02aoURjAOpnWcRGqw7AI8EEyO">
        //v3.0版本的引用方式：src="http://api.map.baidu.com/api?v=3.0&ak=您的密钥"
    </script>
    <script type="text/javascript">

        // 创建一个函数，主要功能是在调用html5的geolocation()前，先判断当前浏览器是否支持html5，（PC绝大部分浏览器不支持或者拒绝html5定位）
        function getLocation() {
            var options = {
                enableHighAccuracy: true,
                maximumAge: 1000
            };
            // alert('正在获取地理位置...');
            if (navigator.geolocation) {
                // 走到这里说明，浏览器支持geolocation，参数里有两个回调函数，一个是定位成功后的处理操作，一个是定位失败后的处理操作，另外一个参数没有研究过
                navigator.geolocation.getCurrentPosition(onSuccess, onError, options);
            } else {
                // 否则浏览器不支持geolocation
                alert('您的浏览器不支持地理位置定位！');
            }
        }

        // 成功时的回调函数
        // 第一步获取定位成功返回的经纬度数据，然后结合百度那边提供的接口进行具体位置的转换，最后还有一个数据提交的方法，要跟自己的业务操作了
        function onSuccess(position) {
            // 返回用户位置
            // 经度
            var longitude = position.coords.longitude;
            // 纬度
            var latitude = position.coords.latitude;

            // alert('您的当前地址的经纬度：经度' + longitude + '，纬度' + latitude);
            // 根据经纬度获取地理位置，不太准确，获取城市区域还是可以的
            var map = new BMap.Map("allmap");
            var point = new BMap.Point(longitude, latitude);
            var gc = new BMap.Geocoder();
            gc.getLocation(point, function (rs) {
                var addComp = rs.addressComponents;
                // alert(addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber);
                // alert("您当前所在位置为：" + addComp.province + ", " + addComp.city + ", " + addComp.district);
                //将获得的定位数据填入位置信息栏
                $("#selectLocation").val(addComp.province);
            });


            // 这里后面可以写你的后续操作了
            // handleData(longitude, latitude);
        }

        // 失败时的回调函数
        // 这里是错误提示信息
        function onError(error) {
            switch (error.code) {
                case 1:
                    alert("位置服务被拒绝！");
                    break;
                case 2:
                    alert("暂时获取不到位置信息！");
                    break;
                case 3:
                    alert("获取信息超时！");
                    break;
                case 4:
                    alert("未知错误！");
                    break;
            }
            // 这里后面可以写你的后续操作了，下面的经纬度是天安门的具体位置
            // 经度
            // var longitude = 39.9151;
            // // 纬度
            // var latitude = 116.4041;
            // handleData(longitude, latitude);
        }

        // 页面载入时请求获取当前地理位置
        // window.onload = function () {
        //     // html5获取地理位置
        //     getLocation();
        // };
    </script>

</body>

</html>